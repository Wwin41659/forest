<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Filecoin Archive</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../basic_usage.html"><strong aria-hidden="true">1.1.</strong> Basic Usage</a></li><li class="chapter-item expanded "><a href="../cli.html"><strong aria-hidden="true">1.2.</strong> Command-line interface</a></li><li class="chapter-item expanded "><a href="../configuration.html"><strong aria-hidden="true">1.3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../environment_variables.html"><strong aria-hidden="true">1.4.</strong> Environment Variables</a></li><li class="chapter-item expanded "><a href="../docker.html"><strong aria-hidden="true">1.5.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../snapshot_export.html"><strong aria-hidden="true">1.6.</strong> Snapshot exporting</a></li><li class="chapter-item expanded "><a href="../js_console.html"><strong aria-hidden="true">1.7.</strong> JavaScript Console</a></li><li class="chapter-item expanded "><a href="../trouble_shooting.html"><strong aria-hidden="true">1.8.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="../glossary.html"><strong aria-hidden="true">1.9.</strong> Glossary</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Developer documentation</li><li class="chapter-item expanded "><a href="../developer_documentation/introduction.html"><strong aria-hidden="true">2.</strong> Developer documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../developer_documentation/application_architecture.html"><strong aria-hidden="true">2.1.</strong> Application architecture</a></li><li class="chapter-item expanded "><a href="../developer_documentation/contributing.html"><strong aria-hidden="true">2.2.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="../developer_documentation/database_migrations.html"><strong aria-hidden="true">2.3.</strong> Database migrations</a></li><li class="chapter-item expanded "><a href="../developer_documentation/local_actions.html"><strong aria-hidden="true">2.4.</strong> Local GH Actions</a></li><li class="chapter-item expanded "><a href="../developer_documentation/mainnet_compatibility.html"><strong aria-hidden="true">2.5.</strong> Mainnet compatibility</a></li><li class="chapter-item expanded "><a href="../developer_documentation/memory-analysis.html"><strong aria-hidden="true">2.6.</strong> Memory analysis</a></li><li class="chapter-item expanded "><a href="../developer_documentation/release_checklist.html"><strong aria-hidden="true">2.7.</strong> Release checklist</a></li><li class="chapter-item expanded "><a href="../developer_documentation/state_migration.html"><strong aria-hidden="true">2.8.</strong> State migration</a></li><li class="chapter-item expanded "><a href="../developer_documentation/state_migration_guide.html"><strong aria-hidden="true">2.9.</strong> State migration guide</a></li><li class="chapter-item expanded "><a href="../developer_documentation/state_migration_spike.html"><strong aria-hidden="true">2.10.</strong> State migration spike NV17-NV18</a></li><li class="chapter-item expanded "><a href="../developer_documentation/test_plan.html"><strong aria-hidden="true">2.11.</strong> Test plan</a></li><li class="chapter-item expanded "><a href="../developer_documentation/devnet_notes.html"><strong aria-hidden="true">2.12.</strong> Devnet Notes</a></li><li class="chapter-item expanded "><a href="../developer_documentation/filecoin_archive.html" class="active"><strong aria-hidden="true">2.13.</strong> Filecoin Archive</a></li><li class="chapter-item expanded "><a href="../developer_documentation/archie_and_fuzzy.html"><strong aria-hidden="true">2.14.</strong> Archie and Fuzzy</a></li><li class="chapter-item expanded "><a href="../developer_documentation/notes_and_sketches.html"><strong aria-hidden="true">2.15.</strong> Notes and sketches</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../developer_documentation/chain_muxer_state_machine.html"><strong aria-hidden="true">2.15.1.</strong> ChainMuxer/TipsetProcessor state machine</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="filecoin-graph"><a class="header" href="#filecoin-graph">Filecoin Graph</a></h1>
<p>A Filecoin blockchain is a single <a href="https://ipld.io/">IPLD</a> <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a>, usually encoded as <a href="https://cbor.io/">CBOR</a>. The
roots of this graph are called <a href="#tipsets">tipsets</a>. Snapshot files (using the
<a href="https://ipld.io/specs/transport/car/carv1/">CARv1</a> file format) contain every block header until genesis and (usually) 2000
recent tipsets. These tipsets (together with additional data downloaded from the
p2p network) are sufficient to synchronize with a Filecoin blockchain.</p>
<p>As of writing, the size of the entire Filecoin blockchain graph for <code>mainnet</code> is
at 14TiB.</p>
<h2 id="tipsets"><a class="header" href="#tipsets">Tipsets</a></h2>
<p>A <a href="https://spec.filecoin.io/#section-glossary.tipset">tipset</a> is a set of
<a href="https://spec.filecoin.io/#section-glossary.block">blocks</a> that were mined at
the same time (e.i. same
<a href="https://spec.filecoin.io/#section-glossary.epoch">epoch</a>). Filecoin uses a
randomized lottery (with the number of tickets depending on your storage
capacity) to determine who is allowed to mine blocks (and thus get rewards). The
number of winners per epoch is 5 on average but may be zero or any other number.</p>
<p>Tipsets are identified by the set of blocks they contain. Thus, a null tipset
cannot be uniquely identified as it has no blocks. When this happens, blocks
refer to the nearest non-null parent. The picture below shows four tipsets at
epoch <code>N</code>, <code>N-1</code>, <code>N-2</code> and <code>N-3</code>. The <code>N-2</code> tipset is a null tipset and cannot
be referenced. As such, blocks in tipset <code>N-1</code> refer directly to the <code>N-3</code>
grand-parent:</p>
<p><img src="Filecoin-Graph.drawio.svg" alt="Filecoin Graph with four tipsets" /></p>
<h2 id="blocks"><a class="header" href="#blocks">Blocks</a></h2>
<p>A block header primarily contains a timestamp, an epoch, a link to the parent
tipset, a link to the state-tree of the parent, and a link to a set of messages
(i.e., transactions). Blocks are block headers combined with messages. The
Filecoin p2p network gives access to all block headers but not all state-trees
and messages.</p>
<h2 id="state-trees-and-mesages"><a class="header" href="#state-trees-and-mesages">State trees and mesages</a></h2>
<p>State trees are persistent data structures built primarily with persistent
hashmaps (<a href="https://ipld.io/specs/advanced-data-layouts/hamt/spec/">HAMT</a>) and persistent vectors (<a href="https://github.com/filecoin-project/go-amt-ipld">AMT</a>). The state tree for a given
epoch will share a lot of nodes with the state tree for the preceding epoch.</p>
<p>Messages are transactions that modify state trees.</p>
<p>Most Filecoin nodes run in lite-mode and only store the most recent state trees
and messages. Only archival nodes have access to the full Filecoin graph (all
messages, all state trees, all blocks, etc).</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<ul>
<li><a href="https://spec.filecoin.io/#section-glossary.tipset">Tipset</a></li>
<li><a href="https://spec.filecoin.io/#section-glossary.block">Block</a></li>
<li><a href="https://spec.filecoin.io/#section-glossary.epoch">Epoch</a></li>
</ul>
<h1 id="forest-archive"><a class="header" href="#forest-archive">Forest archive</a></h1>
<p>Forest aims at providing data for the following use-cases:</p>
<ul>
<li>Quickly syncing to HEAD. This requires up-to-date (less than a day old)
snapshots.</li>
<li>Running archival nodes for unique data. State trees can be re-generated given
enough compute time but block headers and messages cannot. The full block
history should be available and easily accessible.</li>
<li>Accessing state-trees at arbitrary epochs. Storage providers are often
interested in querying the state as it was months or years ago. There should
be an efficient way of accessing ranges of epoch without downloading the
entire graph.</li>
<li>Parallel validation. The Filecoin consensus rules have changed over time, and
the only way to guarantee compliance is to validate all the historical
tipsets. For feasibility, this should be done in parallel.</li>
</ul>
<h2 id="buckets"><a class="header" href="#buckets">Buckets</a></h2>
<ul>
<li><code>/{network}/latest</code>: Recent snapshots. Old files may be deleted after, say, 72
hours.</li>
<li><code>/{network}/snapshots</code>: Historical snapshots at regular epoch intervals. One
snapshot every 2880*7 epochs.</li>
<li><code>/{network}/diffs</code>: Diff files at regular intervals. Diffs are not complete
snapshots and only contain the new key-value pairs since the previous diff.</li>
<li><code>/{network}/diffs/roll-up</code>: Union of diffs over a longer time period. Roll-up
period could be 6 months (2880*30*6 epochs). These roll-ups do not contain
any unique information; they are a more convenient way of downloading diffs.</li>
<li><code>/{network}/spine</code>: Diff files containing only blocks and messages (i.e., the
spine of the blockchain). This is the minimal data required to re-compute the
entire state graph. Diff period could be 1 day (2880 epochs).</li>
<li><code>/{network}/spine/roll-up</code>: Convenience roll-ups for spine diffs.</li>
</ul>
<p>These buckets support several use-cases:</p>
<ul>
<li>Syncing to HEAD using the latest snapshot from <code>/{network}/latest</code>.</li>
<li>The state-tree for an arbitrary epoch can be downloaded by starting with a
nearby historical snapshot and then supplementing it with diff files. For
example, the state-tree for epoch 3000 can be accessed by getting the snapshot
at epoch 2880 and the diff file for epoch range 2880-5760.</li>
<li>Initializing a full archival node can be done by downloading all the diff
roll-ups. Combined, they contain the entire state-graph.</li>
<li>Running a message archival server can be done by downloading the spine diff
roll-ups.</li>
<li>Re-validating tipsets can be done in parallel by merging snapshots and diff
files.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../developer_documentation/devnet_notes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../developer_documentation/archie_and_fuzzy.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../developer_documentation/devnet_notes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../developer_documentation/archie_and_fuzzy.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
